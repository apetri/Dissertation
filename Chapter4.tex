%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Analysis of shear images}
\lhead[\fancyplain{}{\thepage}]{\fancyplain{}{\rightmark}}
 \thispagestyle{plain}
\setlength{\parindent}{10mm}

In this Chapter we describe how we can compress the hight dimensional information contained in shear and convergence images into lower dimensional summary statistics (which we call \textit{features} throughout the remainder of this work), that hopefully contain information about $\Lambda$CDM cosmological parameters. We will focus our analysis on pixelized $\kappa$ images, which are the output of the ray--tracing simulations described in Chapter \ref{chp:3}. The images span a square field of view of size $\theta_{\rm FOV}^2$ and are independent from each other, within the limits of the sampling procedure described in \S~\ref{sec:3:sampling}. Because of the stochastic nature of the convergence profile in the field of view (which ultimately originates from cosmic variance), cosmological information is contained in statistically averaged quantities $\langle f(\h{\kappa})\rangle$, where $f$ is a generic function of $\kappa$. For a Gaussian field, all the statistical information is contained in image features $f$ which are quadratic in $\kappa$, such as the angular power spectrum. Since $\kappa$ traces the non--linear density contrast $\delta$, cosmological information leaks from quadratic features into higher order descriptors. In this work we consider two types of features: we make use of real space features, which have to do with the morphology of the image and can be expressed in terms of expectation values of local estimators. We also consider the angular $\kappa$ power spectrum, which is a non--local feature that encodes spatial quadratic correlations of $\kappa$. In the remainder of the Chapter we examine the most important properties, advantages and drawbacks of these image features. 

\section{Real space local expectation values}
Our knowledge of the angular profiles $\h{\kappa}(\pt)$, combined with the isotropy assumption, allows to estimate the ensemble averages $\langle\rangle$ as spatial averages in real space as 

\begin{equation}
\label{eq:4:average-real}
\langle f(\h{\kappa})\rangle = \frac{1}{\theta^2_{\rm FOV}}\int_{\rm FOV}d\pt f(\h{\kappa})(\pt) 
\end{equation}
%
In this section we will describe a systematic way to relate expectation values of local estimators to the connected moments of $\kappa$, following the derivation given in \citep{MatsubaraLong}. Since the estimators considered in this Chapter will contain at most second spatial derivatives in $\kappa$, we can consider the most general one of them to be some function of the $N$--dimensional vector $\bb{K}$, defined formally by

\begin{equation}
\label{eq:4:lcl-vec}
\bb{K} = (\alpha,\pmb{\eta},\pmb{\zeta}) = \frac{1}{\sigma_0}(\kappa,\nabla \kappa,\partial^2_x\kappa,\partial^2_y\kappa,\partial_x\partial_y\kappa)
\end{equation}
%
Where we indicated as $\pmb{\eta},\pmb{\zeta}$ respectively the first and second derivative of the $\kappa$ field, in units of its variance $\sigma_0^2=\langle\kappa^2\rangle$. Assuming $\langle\kappa\rangle=0$ without loss of generality, we can consider its probability distribution $\mathcal{L}(\bb{K})$ and its characteristic function $Z(\bb{J})$, defined as 

\begin{equation}
\label{eq:4:characteristic}
Z(\bb{J}) = \left\langle e^{i\bb{J}\cdot\bb{K}}\right\rangle = \int d\bb{K}\mathcal{L}(\bb{K})e^{i\bb{J}\cdot\bb{K}}
\end{equation} 
%
Note that, with the definition (\ref{eq:4:characteristic}), the expectation value of any polynomial $K_{i_1}...K_{i_n}$ can be calculated in terms of derivatives of $Z$

\begin{equation}
\label{eq:4:exp-poly}
\left\langle K_{i_1}...K_{i_n}\right\rangle = \left[\left(-i\frac{\partial}{\partial J_{i_i}}\right)...\left(-i\frac{\partial}{\partial J_{i_n}}\right)Z(\bb{J})\right]_{\bb{J}=0}
\end{equation}
%
Writing $Z$ as an exponential of connected terms in the usual way

\begin{equation}
\label{eq:4:gen-connected}
Z(\bb{J}) = \exp\left(\sum_{n=2}^\infty\frac{i^n}{n!}M^{(n)}_{i_1...i_n}J_{i_1}...J_{i_n}\right)
\end{equation}
%
we can immediately identify $M^{(2)}$ as the $\bb{K}$ covariance matrix as $\bb{M}^{(2)}=\langle\bb{K}\bb{K}^T\rangle$. For a Gaussian field, all $M^{(n)}$ with $n>2$ vanish, and the correlations (\ref{eq:4:exp-poly}) are easy to compute because the exponential in (\ref{eq:4:gen-connected}) has only one term. If $\bb{K}$ is non--Gaussian, such in our case, perturbative approaches to the calculation of (\ref{eq:4:exp-poly}) can be attempted if the connected moments $\bb{M}^{(n)}$ do not grow too fast in $n$. These approaches are based on the inverse Fourier transform of $Z$, once the $\bb{M}^{(2)}$ term has been factored out

\begin{equation}
\label{eq:4:characteristic-inverse}
\mathcal{L}(\bb{K}) = \int \frac{d\bb{J}}{(2\pi)^N}\exp\left(-\frac{1}{2}\bb{J}^T\bb{M}^{(2)}\bb{J}-i\bb{J}\cdot\bb{K}\right)\exp\left(\sum_{n=3}^\infty\frac{i^n}{n!}M^{(n)}_{i_1...i_n}J_{i_1}...J_{i_n}\right)
\end{equation} 
%
Since we know that multiplications in $\bb{J}$ space act as gradients in $\bb{K}$ space, and since we know how to perform Gaussian integrals analytically, we can convert (\ref{eq:4:characteristic-inverse}) into  

\begin{equation}
\label{eq:4:characteristic-inverse-2}
\mathcal{L}(\bb{K}) = \exp\left(\sum_{n=3}^\infty\frac{(-1)^n}{n!}M^{(n)}_{i_1...i_n}\partial_{K_{i_1}}...\partial_{K_{i_n}}\right)\mathcal{L}_G(\bb{K})
\end{equation} 
%
\begin{equation}
\label{eq:4:gaussian-lik}
\mathcal{L}_G(\bb{K}) = \frac{1}{\sqrt{(2\pi)^N\vert\bb{M}^{(2)}\vert}}\exp\left(-\frac{1}{2}\bb{K}^T(\bb{M}^{(2)})^{-1}\bb{K}\right)
\end{equation}
%
The form (\ref{eq:4:characteristic-inverse-2}) of the $\bb{K}$ likelihood in term of its connected moments also suggests that, in order to compute the expectation value of a generic function $f(\bb{K})$, we can take advantage of integration by parts and write

\begin{equation}
\label{eq:4:exp-formal}
\langle f(\bb{K})\rangle = \left\langle\exp\left(\sum_{n=3}^\infty\frac{M^{(n)}_{i_1...i_n}}{n!}\partial_{K_{i_1}}...\partial_{K_{i_n}}\right)f(\bb{K})\right\rangle_G
\end{equation}
%
Where the expectation values $\langle\rangle_G$ are computed with the Gaussian likelihood (\ref{eq:4:gaussian-lik}). Expanding the exponential in (\ref{eq:4:exp-formal}) in a power series yields a perturbative expansion for the expectation value $\langle f(\bb{K})\rangle$ in terms of the connected moments $M^{(n)}$. The series is expected to converge if $\bb{M}^{(n)}\rightarrow 0$ as $n$ grows, which might or might not be the case for the $\kappa$ maps under our investigation. Symmetry under rotations assures that the covariance matrix $\bb{M}^{(2)}$ can be parametrized in terms of two parameters $\sigma^2_\eta=\langle\eta^2\rangle,\sigma^2_\zeta=\langle(\zeta_{xx}+\zeta_{yy})^2\rangle$, which constrain the form of $\bb{M}^{(2)}$ as 

\begin{equation}
\label{eq:4:cov-rotinv}
\begin{matrix}
\langle \alpha^2\rangle = 1 & ; & \langle \alpha \pmb{\eta} \rangle = \langle \pmb{\eta}\pmb{\zeta} \rangle = 0 \\ \\
\displaystyle \langle \eta_i\eta_j \rangle = -\langle \alpha \zeta_{ij} \rangle = \frac{\sigma_\eta^2 \delta_{ij}}{2} & ; & \displaystyle \langle \zeta_{ij}\zeta_{kl} \rangle = \frac{\sigma_\zeta^2}{8}(\delta_{ij}\delta_{kl}+\delta_{ik}\delta_{jl}+\delta_{il}\delta_{jk})
\end{matrix}
\end{equation}
%
A perturbative expansion for local expectation values can be built from (\ref{eq:4:exp-formal}) once an assumption is made on the magnitude of the connected moments $\bb{M}^{(n)}$. We will assume, following \citep{MatsubaraLong}, that $\bb{M}^{(n)}=O(\lambda^{n-2})$, where $\lambda$ is a dimensionless parameter which describes small departures from Gaussianity. Note that in order for the perturbation series to converge, $\lambda$ needs to be small. Under this assumption, we can write the expansion for $\langle f \rangle$ up to $O(\lambda^2)$ as 

\begin{equation}
\label{eq:4:pert-quad}
\langle f(\bb{K})\rangle = \langle f(\bb{K})\rangle_G + \langle f(\bb{K})\rangle_3 + \langle f(\bb{K})\rangle_4 + O(\lambda^3) 
\end{equation}
%
with 

\begin{equation}
\label{eq:4:3-contribution}
\langle f(\bb{K})\rangle_3 = \frac{1}{6}\bb{M}^{(3)}_{\bb{i}}\left\langle\frac{\partial f(\bb{K})}{\partial K_{\bb{i}}}\right\rangle_G
\end{equation}
%
\begin{equation}
\label{eq:4:4-contribution}
\langle f(\bb{K})\rangle_4 = \frac{1}{24}\bb{M}^{(4)}_{\bb{i}}\left\langle\frac{\partial f(\bb{K})}{\partial K_{\bb{i}}}\right\rangle_G+ \frac{1}{12}\bb{M}^{(3)}_{\bb{i}}\bb{M}^{(3)}_{\bb{j}}\left\langle\frac{\partial^2 f(\bb{K})}{\partial K_{\bb{i}}\partial K_{\bb{j}}}\right\rangle_G
\end{equation}
%
In equations (\ref{eq:4:3-contribution}), (\ref{eq:4:4-contribution}) we grouped individual $\bb{K}$ vector indexes in the multi--indexes $\bb{i},\bb{j}$. Note that the quartic perturbation term (\ref{eq:4:4-contribution}) picks up disconnected contributions $(\bb{M}^{(3)})^2$ which are of the same order as $\bb{M}^{(4)}$. In the next paragraph we will apply this perturbative approach to morphological descriptors of simulated $\kappa$ images, and test its validity.   

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Minkowski Functionals}
\label{sec:4:mink}
The Large Scale Structure of the Universe at non--linear stage is known to be characterized by prominent morphological features such as one dimensional filaments (see the structure in Figure \ref{fig:3:lens} as an example). In the hope that a morphological description of $\kappa$ contains valuable information about cosmology, we considered the two dimensional morphological descriptors known as Minkowski functionals (MFs) \citep{Tomita,MatsubaraLong}. MFs of $\kappa$ images are based on the construction of the excursion sets, which are spatial partitions of the map based on the $\kappa$ value. A $\kappa_0$--excursion set $\Sigma(\kappa_0)$ is defined to be the set of angular positions $\pt$ for which $\kappa(\pt)>\kappa_0$, as shown in Figure \ref{fig:4:excursion}. The only three morphological descriptors that can be measured from $\kappa$--excursion sets which are invariant under translations and rotations are the area $V_0$ of $\Sigma(\kappa_0)$, the length $V_1$ of its boundary $\partial\Sigma(\kappa_0)$, and its Euler characteristic $V_2$ \citep{MatsubaraLong}. For computational convenience, $V_2$ can be related to the geodesic curvature $\mathcal{K}$ of the excursion set boundary by the Gauss--Bonnet theorem. We can formally define the three MFs $V_k(\kappa_0)$ as 
%
\begin{figure}
\begin{center}
\includegraphics[scale=0.4]{Figures/png/excursion.png}
\end{center}
\caption{Example of a $\kappa$--excursion set (black, right panel) for a simulated field of view of size $\theta_{\rm FOV}=3.5\,{\rm deg}$, with $\kappa_0=0.02$, referred to the image on the left panel. The $\kappa=0.02$ iso--contours have been indicated in red. The sources have been placed at a single redshift $z_s=2$. The image has been smoothed with a Gaussian kernel of size $\theta_G=0.5'$.}
\label{fig:4:excursion}
\end{figure}
%
\begin{equation}
\label{eq:4:formal-mf}
\begin{matrix}
\displaystyle V_0(\kappa_0) = \int_{\Sigma(\kappa_0)} d\pt & ; & \displaystyle V_1(\kappa_0) = \int_{\partial\Sigma(\kappa_0)} dl & ; & \displaystyle V_2(\kappa_0) = \int_{\partial\Sigma(\kappa_0)}\mathcal{K}dl
\end{matrix}
\end{equation}   
%
Where $dl$ is the line element on the boundary. The definitions (\ref{eq:4:formal-mf}) emphasize the symmetry of the MFs under rotations, but do not offer a computationally convenient method to measure them. With a little bit of work, these definitions can be re--arranged in the form (\ref{eq:4:average-real}) as integrals of local quantities over the area of the field of view. The area functional $V_0$ can easily be measured by thresholding the pixels in the $\kappa$ map, namely

\begin{equation}
\label{eq:4:mf0-estimator}
V_0(\kappa_0) = \int d\pt \Theta(\kappa(\pt)-\kappa_0)
\end{equation} 
%
The perimeter functional can be expressed as an area integral with the help of an integration by parts. The boundary of the excursion set $\partial \Sigma(\kappa_0)$, by definition, is the $\kappa\equiv\kappa_0$ set, which is orthogonal to the gradient $\nabla \kappa$. This helps us in finding tangent and normal unit vectors to the boundary, which we call $\bb{t},\bb{n}$. We have

\begin{equation}
\label{eq:4:tn-vectors}
\begin{matrix}
\displaystyle \bb{t} = \left(\frac{\partial_y \kappa}{\vert\nabla\kappa\vert},-\frac{\partial_x \kappa}{\vert\nabla\kappa\vert}\right) & ; & \displaystyle \bb{n} = -\frac{\nabla \kappa}{\vert\nabla\kappa\vert} 
\end{matrix}
\end{equation} 
%
It is easy to show, with the definitions (\ref{eq:4:tn-vectors}), that $\bb{t}\cdot\bb{n}=0$ and that $\bb{n}$ points to the exterior of the excursion set. Now, with a double integration by parts we can show

\begin{equation}
\label{eq:4:mf1-estimator}
V_1(\kappa_0) = \int_{\partial\Sigma(\kappa_0)}\bb{n}\cdot\bb{n}dl = \int d\pt \Theta(\kappa-\kappa_0) \nabla\cdot \bb{n} = \int d\pt \delta^D(\kappa-\kappa_0)\vert\nabla\kappa\vert
\end{equation}
%
Which yields a local estimator of the boundary perimeter, in terms of the gradient of $\kappa$. A similar trick can be employed to compute the Euler functional $V_2$, taking advantage of the definition of the geodesic curvature $\mathcal{K}$ as variation of the tangent $\bb{t}$ across the boundary

\begin{equation}
\label{eq:4:geocurv}
\frac{d\bb{t}}{dl} = \mathcal{K}\bb{n}
\end{equation}
%
which leads to 

\begin{equation}
\label{eq:4:geocurv-2}
\mathcal{K} = \frac{t_it_j\partial_i\partial_j\kappa}{\vert\nabla\kappa\vert}
\end{equation}
%
We can now perform the double integration by parts in a similar way as we did for (\ref{eq:4:mf1-estimator}) to get

\begin{equation}
\label{eq:4:mf2-estimator}
V_2(\kappa_0) = \int d\pt \delta^D(\kappa-\kappa_0)\left(\frac{2\partial_x\partial_y\kappa\partial_x\kappa\partial_y\kappa-\partial^2_x\kappa(\partial_y\kappa)^2-\partial_y^2\kappa(\partial_x\kappa)^2}{\vert\nabla\kappa\vert^2}\right)
\end{equation}
%
Equations (\ref{eq:4:mf0-estimator}), (\ref{eq:4:mf1-estimator}) and (\ref{eq:4:mf2-estimator}) provide practical estimators for measuring the morphological features $V_k$ from an image by thresholding the pixel values and measuring local $\kappa$ gradients. In the next section we will present a relation between $V_k$ and the real space moments of $\kappa$.  

\subsection{Relation with the moments of $\kappa$}
The expectation value of estimators (\ref{eq:4:mf0-estimator}), (\ref{eq:4:mf1-estimator}) and (\ref{eq:4:mf2-estimator}) can be expressed as ensemble expectation values of functions of $\h{\kappa}$ via (\ref{eq:4:average-real}). We can write

\begin{equation}
\label{eq:4:mf-expectation}
\begin{matrix}
V_0(\kappa_0) = \theta_{\rm FOV}^2\langle\Theta(\h{\kappa}-\kappa_0)\rangle \\ \\
V_1(\kappa_0) = \theta_{\rm FOV}^2\langle\delta^D(\h{\kappa}-\kappa_0)\vert\nabla\h{\kappa}\vert\rangle \\ \\
\displaystyle V_2(\kappa_0) = \theta_{\rm FOV}^2\left\langle\delta^D(\h{\kappa}-\kappa_0)\frac{\h{t}_i\h{t}_j\partial_i\partial_j\h{\kappa}}{\vert\nabla\h{\kappa}\vert^2}\right\rangle
\end{matrix}
\end{equation}
%
Taking advantage of the isotropy assumption and noting that, for statistically isotropic two dimensional vector fields $\bbh{u},\bbh{v}$ one use the identities

\begin{equation}
\label{eq:4:iso-vectors}
\begin{matrix}
\displaystyle \langle\h{u}\rangle = \frac{\pi}{2}\langle\vert\h{u}_x\vert\rangle & ; & \displaystyle \langle\bbh{u}\cdot\bbh{v}\rangle = \pi\langle\vert \h{u}_x\vert\delta^D (\h{u}_y)\bbh{u}\cdot\bbh{v}\rangle
\end{matrix}
\end{equation}
%
which, applied to (\ref{eq:4:mf-expectation}) with $\bb{u}=\nabla\kappa$ and $v_i=\partial_i\partial_j\kappa\partial_j\kappa/\vert\nabla\kappa\vert^2$, give the expressions

\begin{equation}
\label{eq:4:mf0-expectation}
V_0(\kappa_0) = \theta_{\rm FOV}^2\langle\Theta(\h{\kappa}-\kappa_0)\rangle
\end{equation} 
%
\begin{equation}
\label{eq:4:mf1-expectation}
V_1(\kappa_0) = \frac{\pi}{2}\theta_{\rm FOV}^2\langle\delta^D(\h{\kappa}-\kappa_0)\vert\partial_x\h{\kappa}\vert\rangle
\end{equation} 
%
\begin{equation}
\label{eq:4:mf2-expectation}
V_2(\kappa_0) = -\pi\theta_{\rm FOV}^2\langle\delta^D(\h{\kappa}-\kappa_0)\delta^D(\partial_y\h{\kappa})\vert\partial_x\h{\kappa}\vert\partial^2_y\h{\kappa}\rangle
\end{equation}
%
The parametrization of the covariance matrix (\ref{eq:4:cov-rotinv}) allows to calculate explicitly expectation values of particular classes of estimators $f$ which are local in the convergence, such as (\ref{eq:4:mf0-expectation}), (\ref{eq:4:mf1-expectation}) and (\ref{eq:4:mf2-expectation}). Per equation (\ref{eq:4:exp-formal}), we need to calculate Gaussian expectation values of arbitrary $\alpha,\pmb{\eta},\pmb{\zeta}$ derivatives of the local estimator. After some Gaussian integral algebra we obtain

\begin{equation}
\label{eq:4:Rv0}
\langle\partial_\alpha^n\Theta(\alpha-\nu)\rangle_G = \frac{(-1)^{n-1}}{\sqrt{2\pi}}e^{-\nu^2/2}H_{n-1}(\nu) 
\end{equation}
%
\begin{equation}
\label{eq:4:Rv1}
\langle\partial_\alpha^n\partial_{\eta_x}^m\delta^D(\alpha-\nu)\vert\eta_x\vert\rangle_G = \frac{H_{m-2}(0)}{\pi}\left(\frac{\sigma_\eta}{\sqrt{2}}\right)^{1-m}e^{-\nu^2/2}H_n(\nu) 
\end{equation} 
%
\hfill
\begin{equation}
\label{eq:4:Rv2}
\begin{gathered}
\langle\partial_\alpha^k\partial_{\eta_y}^{l_1}\partial_{\eta_x}^{l_2}\partial_{\zeta_{yy}}^m\delta^D(\alpha-\nu)\delta^D(\eta_y)\vert\eta_x\vert\zeta_{yy}\rangle_G = \\
\frac{H_{l_1}(0)H_{l_2-2}(0)}{(2\pi)^{3/2}}\left(\frac{\sigma_\eta}{\sqrt{2}}\right)^{2-l_1-l_2-2m}e^{-\nu^2/2}[H_{k+1}(\nu)\delta_{m0}-H_k(\nu)\delta_{m1}]
\end{gathered} 
\end{equation} 
%
Where the Hermite polynomials $H_n$ are defined as 

\begin{equation}
\label{eq:4:hermite}
\begin{matrix}
\displaystyle H_{-1}(x) \equiv \sqrt{\frac{\pi}{2}}e^{x^2/2}{\rm erfc}\left(\frac{x}{\sqrt{2}}\right) & ; & \displaystyle H_n(x) \equiv e^{x^2/2}\left(-\frac{d}{dx}\right)^n e^{-x^2/2} & ; & H_{-2}(0)\equiv 1 
\end{matrix}
\end{equation}
%
These expressions, after some tedious algebra, lead to the connection between the MFs and the moments of $\kappa$ via the perturbative approach (\ref{eq:4:pert-quad})

\begin{equation}
\label{eq:4:Vk-pert}
V_k(\kappa_0=\sigma_0\nu) = A_k e^{-\nu^2/2}\left[V_k^G(\nu)+\delta V^1_k(\nu) + \delta V^2_k(\nu) + O(\lambda^3)\right] 
\end{equation}
%
In this notation, $V_k^G=H_{k-1}$ is the Gaussian contribution to the $k$--th MF and $\delta V^1_k,\delta V^2_k$ are the corrections coming respectively from $O(\lambda)$, $O(\lambda^2)$ non--Gaussianity in $\kappa$. For reference, the amplitudes $A_k$ are defined as 

\begin{equation}
\label{eq:4:amplitude}
\begin{matrix}
\displaystyle A_0 = \frac{\theta_{\rm FOV}^2}{\sqrt{2\pi}} & ; & \displaystyle A_1 = \frac{\sigma_\eta\theta_{\rm FOV}^2}{2\sqrt{2}} & ; & \displaystyle A_2 = \frac{\sigma_\eta^2\theta^2_{\rm FOV}}{\sqrt{8\pi}}
\end{matrix}
\end{equation}
%
\begin{figure}
\begin{center}
\includegraphics[scale=0.4]{Figures/eps/minkPerturbation0-1.eps}
\includegraphics[scale=0.4]{Figures/eps/minkPerturbation2.eps}
\end{center}
\caption{Comparison between the MFs measured from a sample of our simulated fiducial $\kappa$ maps and the approximation based on perturbation theory up to order $O(\bb{M}^{(4)})$ (or $O(\lambda^2)$). We show the mean of the measured MFs calculated over 1000 $\kappa$ realizations (single redshift $z_s=1$, smoothed with $\theta_G=0.5'$) and the perturbative approach at Gaussian $O(\bb{M}^{(2)})$ order (blue) and including skewness $O(\bb{M}^{(3)})$ (green) and kurtosis $O(\bb{M}^{(4)})$ corrections. The moments $\pmb{\mu}$ have also been measured from the mean of the same 1000 $\kappa$ realizations}
\label{fig:4:minkpert}
\end{figure}
%
\begin{figure}
\begin{center}
\includegraphics[scale=0.5]{Figures/eps/minkConvergence.eps}
\end{center}
\caption{Study of the convergence of the perturbative approach based on equation (\ref{eq:4:Vk-pert}). We measure the degree of convergence using a $\Delta\chi^2$ metric defined as $\Delta\chi^2=(V_k^{\rm meas}-V_k^{\rm pert})^T\bb{C}_{kk}^{-1}(V_k^{\rm meas}-V_k^{\rm pert})$, where $V_k^{\rm meas}$ are the measured MFs, $V_k^{\rm pert}$ are the approximated MFs at different orders in perturbation theory and $\bb{C}_{kk}$ is the covariance between different thresholds, measured from simulations. We show results for the area $V_0$ (blue), perimeter $V_1$ (green) and the Euler characteristic $V_2$ (red) of the excursion sets. Different line styles correspond to the different sized of the Gaussian smoothing windows $\theta_G$ applied to the images.}
\label{fig:4:minkconv}
\end{figure}
%
\citep{Munshi12} performed the calculations up to perturbative order $O(\lambda^2)$ and found that the knowledge of seven independent higher moments of $\kappa$ is sufficient to calculate the corrections. 

\begin{equation}
\label{eq:4:skew-dimensionless}
\begin{matrix}
\displaystyle \mu_{30} = \frac{\langle\kappa^3\rangle}{\sigma_0^3} & ; & \displaystyle \mu_{31} = -\frac{3}{4} \frac{\langle\kappa^2\nabla^2\kappa\rangle}{\sigma_0^3\sigma_\eta^2} & ; & \displaystyle \mu_{32} = -3 \frac{\langle\vert\nabla\kappa\vert^2\nabla^2\kappa\rangle}{\sigma_0^3\sigma_\eta^4}
\end{matrix}
\end{equation}
%
\begin{equation}
\label{eq:4:kurt-dimensionless}
\begin{matrix}
\displaystyle \mu_{40} = \frac{\langle\kappa^4\rangle_c}{\sigma_0^4} & ; & \displaystyle \mu_{41} = \frac{\langle\kappa^3\nabla^2\kappa\rangle_c}{\sigma_0^4\sigma_\eta^2} \\ \\ 
\displaystyle \mu_{42} = \frac{\langle\kappa\vert\nabla\kappa\vert^2\nabla^2\kappa\rangle_c}{\sigma_0^4\sigma_\eta^4} & ; & \displaystyle \mu_{43} = \frac{\langle\vert\nabla\kappa\vert^4\rangle_c}{2\sigma_0^4\sigma_\eta^4}
\end{matrix}
\end{equation}
%
We use the subscript $c$ to indicate the connected component of the quartic moments $\pmb{\mu}_4$. The non--Gaussian corrections to the MFs can be expressed as 

\begin{equation}
\label{eq:4:Vk-pert-skew}
\delta V^1_k = \frac{\mu_{30}}{6}H_{k+2} + \frac{k\mu_{31}}{3}H_k + \frac{k(k-1)\mu_{32}}{6}H_{k-2}
\end{equation}
%
\begin{equation}
\label{eq:4:Vk-pert-kurt}
\begin{gathered}
\displaystyle \delta V^2_0 = \frac{\mu_{30}^2}{72}H_5 + \frac{\mu_{40}}{24}H_3 \\
\displaystyle \delta V^2_1 = \frac{\mu_{30}^2}{72}H_6 + \left(\frac{\mu_{40}-\mu_{30}\mu_{31}}{24}\right)H_4 - \frac{1}{12}\left(\mu_{41}+\frac{3}{8}\mu_{31}^2\right)H_2 - \frac{\mu_{43}}{8}  \\ 
\displaystyle \delta V^2_2 = \frac{\mu_{30}^2}{72}H_7 + \left(\frac{\mu_{40}-\mu_{30}\mu_{31}}{24}\right)H_5 - \frac{1}{6}\left(\mu_{41}+\frac{\mu_{30}\mu_{32}}{2}\right)H_3 - \frac{1}{2}\left(\mu_{42}+2\mu_{43}+\frac{\mu_{31}\mu_{32}}{2}\right)H_1 
\end{gathered}
\end{equation}
%
Figures \ref{fig:4:minkpert},\ref{fig:4:minkconv} show comparisons between measured MFs from our simulated $\kappa$ images (using estimators (\ref{eq:4:mf0-estimator}), (\ref{eq:4:mf1-estimator}) and (\ref{eq:4:mf2-estimator})) and the $O(\lambda^2)$ perturbative approach based on equations (\ref{eq:4:Vk-pert-skew}), (\ref{eq:4:Vk-pert-kurt}). We can clearly observe a departure between the measured MFs profile and the moment--based approximation, even when non--Gaussian corrections up to $O(\lambda^2)$ are taken into account. Figure \ref{fig:4:minkconv} clearly shows that the $\lambda$ power series converges faster when a large smoothing kernel is applied to the $\kappa$ images, because of the mitigating effect that smoothing has on non--Gaussianity. As we are going to see in Chapter \ref{chp:5}, however, large smoothing kernels cause loss of cosmological information loss WL data because they erase meaningful features from which $\Lambda$CDM parameters can be extracted. Because for small smoothing scales MFs and the first few moments of $\kappa$ are not equivalent, morphological descriptors might contain information on cosmology that moments by themselves are missing. This issue will be investigated in Chapter \ref{chp:5}.    

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Peak counts}
In the previous section we showed how morphological features in $\kappa$ maps are approximately related to quadratic and higher--than--quadratic local moments of $\kappa$. In the case of Gaussian fields, MFs are completely characterized in terms of the two quadratic moments $\sigma_0,\sigma_\eta$ but, if non--Gaussianity is present, they contain information on arbitrarily high order $\kappa$ local correlators. A similar argument can be carried out for a different type of local feature in $\kappa$ maps, such as the statistical properties of local maxima (which we will call \textit{peaks} from now on). In this section we will explore the usage peak counts $N_{\rm pk}$ as a function of their height $\kappa_0$, as an image feature. A $\kappa$ peak can be identified at a location $\pt_p$ if the image gradient $\pmb{\eta}$ vanishes at this location and the Hessian matrix $\pmb{\zeta}$ is positive definite. Following \citep{BondCMB}, we can define the peak angular density at a location $\pt$ as 

\begin{equation}
\label{eq:4:peak-density}
n_{\rm pk}(\pt) = \sum_p \delta^D(\pt-\pt_p) = \vert\pmb{\zeta}(\pt)\vert\delta^D(\pmb{\eta}(\pt))
\end{equation}
%
Where the sum extends over all peaks in the map and the Jacobian determinant is defined as $\vert\pmb{\zeta}\vert=\zeta_{xx}\zeta_{yy}-\zeta_{xy}^2$. If we are interested in computing the expected number of peaks of a certain height $\kappa_0=\sigma_0\nu$ in a $\kappa$ image, we have to calculate the expectation value of the local estimator

\begin{equation}
\label{eq:4:peak-estimator}
\frac{dN_{\rm pk}}{d\nu} = \theta^2_{\rm FOV}\left\langle\delta^D(\alpha-\nu)\delta^D(\pmb{\eta})\vert\pmb{\zeta}\vert\Theta(\vert\pmb{\zeta}\vert)\Theta(\Tr\pmb{\zeta})\right\rangle
\end{equation}
%
The product of $\Theta$ functions in (\ref{eq:4:peak-estimator}) ensures that the extremum of $\kappa$ is actually a maximum and not a minimum or a saddle point. Note that we related the peak histogram to the expectation value of a local estimator, which can be calculated in perturbation series using (\ref{eq:4:exp-formal}) in the same fashion as the MFs, although the calculation is more involved. In this paragraph, we will limit ourselves to giving an expression for $\frac{dN_{\rm pk}}{d\nu}$ at Gaussian order. In order to ease the calculations, it is useful to introduce a parametrization for $\pmb{\zeta}$ in terms of three parameters $t,u,\phi$

\begin{equation}
\label{eq:4:hess-param}
\pmb{\zeta} = -\sigma_\zeta
\begin{pmatrix}
\displaystyle \frac{x}{2}+x\epsilon\cos(2\phi) & x\epsilon\sin(2\phi) \\
x\epsilon\sin(2\phi) & \displaystyle \frac{x}{2}-x\epsilon\cos(2\phi)
\end{pmatrix}
\end{equation}  
%
In this parametrization $x,\epsilon$ are scalars under rotations because $\sigma_\zeta x=-\Tr\pmb{\zeta}, \sigma_\zeta^2x^2(1-4\epsilon^2)/4=\vert\pmb{\zeta}\vert$, and $\phi$ transforms as an angle shift. With the help of the rotational symmetry, and the change of variable

\begin{equation}
\label{eq:4:wx}
\begin{matrix}
\displaystyle u = \frac{\alpha-\gamma x}{\sqrt{1-\gamma^2}} & ; & \displaystyle \gamma = \frac{\sigma_\eta^2}{\sigma_\zeta}
\end{matrix}
\end{equation} 
%
we can write the Gaussian likelihood (\ref{eq:4:gaussian-lik}) as 

\begin{equation}
\label{eq:4:gaussian-lik-pk}
\mathcal{L}_G(\bb{K})d\bb{K} = \frac{8\epsilon x^2}{2\pi^3\sigma_\eta^2}\exp\left(-\frac{u^2+x^2}{2}-\frac{\eta^2}{\sigma_\eta^2}-4x^2\epsilon^2\right)dudxd\pmb{\eta}d\epsilon d\phi
\end{equation} 
%
The expectation value (\ref{eq:4:peak-estimator}) can be expressed in a more friendly way as 

\begin{equation}
\label{eq:4:peak-estimator-2}
\left(\frac{dN_{\rm pk}}{d\nu}\right)_G = \frac{\theta^2_{\rm FOV}\sigma^2_\zeta}{4}\left\langle\delta^D\left(u\sqrt{1-\gamma^2}+\gamma x-\nu\right)\delta^D(\pmb{\eta})x^2(1-4\epsilon^2)\Theta(-x)\Theta(1-4\epsilon^2)\right\rangle_G
\end{equation}
%
Although tedious, the Gaussian integrals in (\ref{eq:4:peak-estimator-2}) can be performed explicitly \citep{BondCMB} to yield
%
\begin{equation}
\label{eq:4:peaks-gaussian}
\frac{dN_{\rm pk}(\nu)}{d\nu} = \frac{(\sigma_\eta\theta_{\rm FOV})^2}{2(2\pi)^{3/2} \gamma^2}e^{-\nu^2/2}G(\gamma,\gamma\nu)
\end{equation}
%
\begin{equation}
\label{eq:4:Gdef}
\begin{gathered}
G(\gamma,t) = (t^2-\gamma^2)\left[1-\frac{1}{2}{\rm erfc}\left(\frac{t}{\sqrt{2(1-\gamma^2)}}\right)\right] \\
+ \frac{t(1-\gamma^2)}{\sqrt{2\pi(1-\gamma^2)}} + \frac{e^{-t^2/(3-2\gamma^2)}}{\sqrt{3-2\gamma^2}}\left[1-\frac{1}{2}{\rm erfc}\left(\frac{t}{\sqrt{2(1-\gamma^2)(3-2\gamma^2)}}\right)\right]
\end{gathered}
\end{equation}
%
\begin{figure}
\begin{center}
\includegraphics[scale=0.4]{Figures/png/convergencePeaks.png}
\end{center}
\caption{A sample $\kappa$ map ($\theta_{\rm FOV}=3.5\,{\rm deg}$) with its peak locations (identified by the 8 nearest neighboring pixels) highlighted in red dots. The right panel shows the peak number (blue) as a function of the peak height $\nu\sigma_0$ (blue). The panel also shows the peak histogram for a Gaussian $\kappa$ field with the same power spectrum as the simulated one (green) and the Gaussian prediction for $dN_{\rm pk}/d\nu$ obtained with equation (\ref{eq:4:peaks-gaussian}).}
\label{fig:4:peaks}
\end{figure}
%
Figure \ref{fig:4:peaks} shows a comparison between the peak histogram measured from one of our simulated $\kappa$ maps and the histogram predicted using the Gaussian approximation (\ref{eq:4:peaks-gaussian}), which makes use of the quadratic $\kappa$ moments $\sigma_0,\sigma_\eta,\sigma_\zeta$. We can clearly see a departure of the measured peak histogram profile from the Gaussian approximated one. The measured peak histogram displays a high $\kappa$ tail that the Gaussian formula (\ref{eq:4:peaks-gaussian}) completely ignores. This might be a hint that the peak histogram profile might contain more cosmological information than quadratic $\kappa$ moments. This will be matter of investigation in Chapter \ref{chp:5}.    

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Angular power spectrum}
In the previous sections we considered image features which are local, or can be expressed in terms estimators which are local in the convergence $\kappa$. In this section we will deviate from locality and focus on the information contained in larger scale correlations in $\kappa$. The most obvious feature one can consider is the $\kappa$ angular two--point function, defined as 

\begin{equation}
\label{eq:4:kappa-2pt}
\xi_{\kappa\kappa}(\alpha) = \langle\h{\kappa}(\pt)\h{\kappa}(\pt+\palpha)\rangle 
\end{equation} 
%
In the definition (\ref{eq:4:kappa-2pt}) the correlation function $\xi_{\kappa\kappa}$ is expected to depend only on the magnitude $\alpha=\vert\palpha\vert$ of the angular lag $\palpha$ because of invariance under translations and rotations. Quadratic non--local correlations such as the one defined in (\ref{eq:4:kappa-2pt}) are better expressed in Fourier space as

\begin{equation}
\label{eq:4:kappa-power}
\left\langle\h{\tilde{\kappa}}(\pell)\h{\tilde{\kappa}}(\pell')\right\rangle = (2\pi)^2 \delta^D(\pell+\pell')P_{\kappa\kappa}(\ell)
\end{equation}
%
Where again translational invariance cause the Dirac delta to appear in (\ref{eq:4:kappa-power}) and rotational invariance makes the angular power spectrum $P_{\kappa\kappa}$ depend on $\ell=\vert\pell\vert$ only. Using both (\ref{eq:4:kappa-2pt}) and (\ref{eq:4:kappa-power}) we can relate $\xi_{\kappa\kappa}$ and $P_{\kappa\kappa}$ in the limit of full sky coverage as 

\begin{equation}
\label{eq:4:xi-pow}
\xi_{\kappa\kappa}(\alpha) = \int \frac{d\pell}{(2\pi)^2}P_{\kappa\kappa}(\ell)e^{i\pell\cdot\palpha}
\end{equation}
%
The relation (\ref{eq:4:xi-pow}) is valid in the flat sky limit, with spherical harmonic corrections kicking in for large scales and small multipoles.
%
\begin{figure}
\begin{center}
\includegraphics[scale=0.5]{Figures/eps/powerSample.eps}
\end{center}
\caption{Power spectrum sample}
\label{fig:4:psample}
\end{figure}
%
A practical estimator for $P_{\kappa\kappa}$ can be obtained by replacing the expectation value in (\ref{eq:4:kappa-power}) with an integral in Fourier space over the multipoles with constant magnitude $\ell=\vert\pell\vert$. One can show that, if the Fourier transform of $\kappa$ is computed in a window of size $\theta_{\rm FOV}^2$, the estimator

\begin{equation}
\label{eq:4:powerest}
\h{P}_{\kappa\kappa}(\ell) = \frac{1}{\theta_{\rm FOV}^2}\int_{\vert\pell\vert=\ell}\frac{d\pell}{2\pi\ell}\left\vert\h{\tilde{\kappa}}(\pell)\right\vert^2
\end{equation}
%
converges to the real $P_{\kappa\kappa}$ if $\theta_{\rm FOV}$ is sufficiently large compared to the $\kappa$ angular correlation scale. 



\subsection{Born approximation}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Convergence moments}

\subsection{Born approximation}

\bibliography{ref}